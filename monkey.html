<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Công cụ chuyển mã màu điện trở</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .color-bar { width: 40px; height: 120px; display: inline-block; margin: 2px; border: 1px solid #222; }
    label, input, select { margin: 4px; }
    #result { margin-top: 20px; }
  </style>
</head>
<body>
  <h2>Công cụ chuyển giá trị điện trở sang mã màu</h2>
  <form id="resistorForm">
    <label for="value">Giá trị (Ω):</label>
    <input type="text" id="value" placeholder="Ví dụ: 4700, 4.7k, 2.2M" required>
    <label for="tolerance">Sai số:</label>
    <select id="tolerance">
      <option value="1">1%</option>
      <option value="2">2%</option>
      <option value="5">5%</option>
      <option value="10">10%</option>
      <option value="0.5">0.5%</option>
      <option value="0.25">0.25%</option>
      <option value="0.1">0.1%</option>
      <option value="0.05">0.05%</option>
    </select>
    <label for="bands">Số vạch màu:</label>
    <select id="bands">
      <option value="3">3</option>
      <option value="4" selected>4</option>
      <option value="5">5</option>
    </select>
    <button type="submit">Chuyển mã màu</button>
  </form>
  <div id="result"></div>
  <hr>
  <div>
    <h3>Công thức tính mã màu điện trở:</h3>
    <ul>
      <li><b>3 vạch:</b> [Số thứ nhất] - [Số thứ hai] - [Hệ số nhân]</li>
      <li><b>4 vạch:</b> [Số thứ nhất] - [Số thứ hai] - [Hệ số nhân] - [Sai số]</li>
      <li><b>5 vạch:</b> [Số thứ nhất] - [Số thứ hai] - [Số thứ ba] - [Hệ số nhân] - [Sai số]</li>
    </ul>
    <p><i>Ví dụ: 1000Ω ±5% → Nâu - Đen - Đỏ - Vàng kim</i></p>
  </div>

  <script>
  const colors = [
    {name: "Đen", code: "black", digit: 0, multiplier: 1, rgb: "#000"},
    {name: "Nâu", code: "brown", digit: 1, multiplier: 10, tolerance: 1, rgb: "#8B4513"},
    {name: "Đỏ", code: "red", digit: 2, multiplier: 100, tolerance: 2, rgb: "#FF0000"},
    {name: "Cam", code: "orange", digit: 3, multiplier: 1e3, rgb: "#FFA500"},
    {name: "Vàng", code: "yellow", digit: 4, multiplier: 1e4, rgb: "#FFFF00"},
    {name: "Lục", code: "green", digit: 5, multiplier: 1e5, tolerance: 0.5, rgb: "#008000"},
    {name: "Lam", code: "blue", digit: 6, multiplier: 1e6, tolerance: 0.25, rgb: "#0000FF"},
    {name: "Tím", code: "violet", digit: 7, multiplier: 1e7, tolerance: 0.1, rgb: "#800080"},
    {name: "Xám", code: "grey", digit: 8, multiplier: 1e8, tolerance: 0.05, rgb: "#808080"},
    {name: "Trắng", code: "white", digit: 9, multiplier: 1e9, rgb: "#FFF"},
    {name: "Vàng kim", code: "gold", multiplier: 0.1, tolerance: 5, rgb: "#FFD700"},
    {name: "Bạc", code: "silver", multiplier: 0.01, tolerance: 10, rgb: "#C0C0C0"}
  ];

  // --- Đổi hậu tố k, M thành số ---
  function parseValue(input) {
    input = input.trim().toLowerCase();
    let num = parseFloat(input);
    if (input.endsWith("k")) num *= 1e3;
    if (input.endsWith("m")) num *= 1e6;
    return num;
  }

  function formatOhm(value) {
    if (value >= 1e6) return (value/1e6).toFixed(2).replace(/\.00$/, "") + " MΩ";
    if (value >= 1e3) return (value/1e3).toFixed(2).replace(/\.00$/, "") + " kΩ";
    return value + " Ω";
  }

  function getColorByDigit(digit) {
    return colors.find(c => c.digit === digit);
  }
  function getColorByMultiplier(multiplier) {
    return colors.find(c => c.multiplier === multiplier);
  }
  function getColorByTolerance(tol) {
    return colors.find(c => c.tolerance === tol);
  }

  // --- Chuyển số thành ký hiệu mũ nhỏ ---
  function toSuperscript(num) {
    const map = { "0":"⁰","1":"¹","2":"²","3":"³","4":"⁴","5":"⁵","6":"⁶","7":"⁷","8":"⁸","9":"⁹","-":"⁻" };
    return String(num).split("").map(ch => map[ch] || ch).join("");
  }

  function resistorToColorBands(value, tolerance, bands) {
    let digits = [];
    let val = value;
    let power = Math.floor(Math.log10(val));
    let norm = val / Math.pow(10, power);

    if (bands === 3 || bands === 4) {
      let d1 = Math.floor(norm);
      let d2 = Math.floor(norm * 10) % 10;
      digits = [d1, d2];
      let multiplier = Math.pow(10, power - 1);
      return {digits, multiplier, tolColor: getColorByTolerance(tolerance)};
    }
    if (bands === 5) {
      let d1 = Math.floor(norm);
      let d2 = Math.floor(norm * 10) % 10;
      let d3 = Math.floor(norm * 100) % 10;
      digits = [d1, d2, d3];
      let multiplier = Math.pow(10, power - 2);
      return {digits, multiplier, tolColor: getColorByTolerance(tolerance)};
    }
  }

  document.getElementById('resistorForm').onsubmit = function(e) {
    e.preventDefault();
    let raw = document.getElementById('value').value;
    let value = parseValue(raw);
    let tolerance = Number(document.getElementById('tolerance').value);
    let bands = Number(document.getElementById('bands').value);

    if (isNaN(value) || value < 1) {
      document.getElementById('result').innerHTML = "Giá trị phải hợp lệ và lớn hơn 0!";
      return;
    }

    let {digits, multiplier, tolColor} = resistorToColorBands(value, tolerance, bands);
    let multColor = getColorByMultiplier(multiplier);

    let bandColors = [];
    let detail = "";

    if (bands === 3) {
      bandColors = [getColorByDigit(digits[0]), getColorByDigit(digits[1]), multColor];
      detail = `${digits[0]} (${bandColors[0].name})  ${digits[1]} (${bandColors[1].name}) × 10${toSuperscript(Math.log10(multColor.multiplier))} (${multColor.name})`;
    }
    if (bands === 4) {
      bandColors = [getColorByDigit(digits[0]), getColorByDigit(digits[1]), multColor, tolColor];
      detail = `${digits[0]} (${bandColors[0].name})  ${digits[1]} (${bandColors[1].name}) × 10${toSuperscript(Math.log10(multColor.multiplier))} (${multColor.name})   Sai số ±${tolerance}% (${tolColor.name})`;
    }
    if (bands === 5) {
      bandColors = [getColorByDigit(digits[0]), getColorByDigit(digits[1]), getColorByDigit(digits[2]), multColor, tolColor];
      detail = `${digits[0]} (${bandColors[0].name})  ${digits[1]} (${bandColors[1].name})  ${digits[2]} (${bandColors[2].name}) × 10${toSuperscript(Math.log10(multColor.multiplier))} (${multColor.name})   Sai số ±${tolerance}% (${tolColor.name})`;
    }

    let html = "<b>Mã màu:</b><br>";
    bandColors.forEach(c => {
      html += `
        <div style="display:inline-block; text-align:center;">
          <div class="color-bar" style="background:${c ? c.rgb : '#fff'}" title="${c ? c.name : 'Không xác định'}"></div>
          <div style="font-size:13px;">${c ? c.name : 'Không xác định'}</div>
        </div>`;
    });
    html += "<br>";
    html += `Giá trị: ${formatOhm(value)} , Sai số: ${tolerance}%, Số vạch: ${bands}<br><br>`;
    html += "<b>Chi tiết:</b><br>" + detail;

    document.getElementById('result').innerHTML = html;
  };
  </script>
</body>
</html>